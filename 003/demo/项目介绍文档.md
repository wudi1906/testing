# 智能文档对话系统 - 项目介绍

## 📋 项目概述

本项目是一个基于 **AutoGen** 多智能体框架和 **Marker** 高质量文档处理技术的智能文档对话系统。系统能够处理多种格式的文档（PDF、Word、Excel等），并通过多智能体协作为用户提供基于文档内容的智能问答服务。

### 🎯 核心功能

- **📄 智能文档处理**: 支持PDF、DOCX、XLSX等多种格式，使用Marker进行高质量文档解析
- **🤖 多智能体对话**: 基于AutoGen框架的多智能体协作，包含主要智能体、评审智能体和用户代理
- **💬 流式对话体验**: 实时流式响应，提供类似ChatGPT的对话体验
- **🔄 会话管理**: 支持多会话并行，文档与会话关联管理
- **⚡ 智能缓存**: 文件解析结果缓存，避免重复处理
- **🎨 现代化UI**: 基于React + Ant Design的响应式界面

## 🏗️ 技术架构

### 整体架构图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端界面      │    │   后端API      │    │   AI服务层      │
│   React + AntD  │◄──►│   FastAPI      │◄──►│   AutoGen      │
│                 │    │                 │    │   + LLM        │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                              ▼
                       ┌─────────────────┐
                       │   文档处理层    │
                       │   Marker + 组件 │
                       └─────────────────┘
                              │
                              ▼
                       ┌─────────────────┐
                       │   存储层        │
                       │   文件系统+缓存 │
                       └─────────────────┘
```

### 技术栈组成

#### 🎨 前端技术栈
- **React 18**: 现代化前端框架
- **Ant Design 5**: 企业级UI组件库
- **Vite**: 快速构建工具
- **Framer Motion**: 流畅动画效果
- **React Markdown**: Markdown渲染
- **React Syntax Highlighter**: 代码高亮

#### ⚙️ 后端技术栈
- **FastAPI**: 高性能异步Web框架
- **AutoGen**: 微软多智能体框架
- **Marker**: 高质量PDF处理库
- **Uvicorn**: ASGI服务器
- **Pydantic**: 数据验证和序列化

#### 🧠 AI技术栈
- **AutoGen AgentChat**: 多智能体对话框架
- **DeepSeek API**: 主要LLM服务提供商
- **OpenAI/通义千问**: 可选的LLM增强服务
- **流式处理**: 实时响应生成

## ✨ 技术亮点

### 1. 🤖 多智能体协作架构

系统采用AutoGen的多智能体协作模式：

- **主要智能体 (Primary Agent)**: 专门负责测试用例设计，具备10年+测试架构师经验
- **评审智能体 (Critic Agent)**: 负责测试用例质量评审和改进建议
- **用户代理 (User Proxy)**: 处理用户反馈和交互

```python
# 智能体协作流程
team = RoundRobinGroupChat([primary_agent, critic_agent, user_proxy], 
                          termination_condition=text_termination)
```

### 2. 📄 高质量文档处理

基于Marker的先进文档处理能力：

- **多格式支持**: PDF、DOCX、XLSX、PPTX、HTML等
- **结构保持**: 保持原文档的表格、标题、格式结构
- **图片描述**: 使用多模态LLM对图片进行智能描述
- **数学公式**: 准确识别和转换数学表达式

```python
# 文档处理配置
config = MarkerConfig(
    output_format="markdown",
    use_llm=True,
    enable_image_description=True,
    format_lines=True
)
```

### 3. ⚡ 智能缓存机制

- **文件哈希缓存**: 基于文件内容MD5避免重复解析
- **会话关联**: 文档与会话ID关联，支持多会话并行
- **内存+持久化**: 内存缓存+JSON文件持久化存储

### 4. 🔄 流式响应处理

- **Server-Sent Events**: 基于SSE的实时流式响应
- **分块传输**: 逐步传输AI生成内容
- **状态管理**: 完整的流式状态管理（开始、进行中、结束）

### 5. 🎨 现代化用户界面

- **响应式设计**: 适配各种屏幕尺寸
- **玻璃拟态效果**: 现代化视觉设计
- **实时动画**: Framer Motion提供流畅动画
- **代码高亮**: 支持多语言代码高亮显示

## 🔧 核心组件

### 后端核心服务

#### 1. ChatService (聊天服务)
```python
class ChatService:
    - 多智能体团队管理
    - 流式对话处理
    - 会话状态管理
    - 用户反馈处理
```

#### 2. DocumentService (文档服务)
```python
class DocumentService:
    - 文件上传和解析
    - 会话文档关联
    - 缓存管理
    - 内容提取和搜索
```

#### 3. FileProcessor (文件处理器)
```python
class FileProcessor:
    - 多格式文件处理
    - Marker集成
    - 异步处理支持
    - 结构化内容提取
```

### 前端核心组件

#### 1. App.jsx (主应用)
- 整体布局和状态管理
- 消息流处理
- 文件上传集成

#### 2. MessageRenderer (消息渲染器)
- Markdown内容渲染
- 代码块高亮
- 表格和链接处理

#### 3. FeedbackModal (反馈模态框)
- 用户反馈收集
- 智能体交互界面

## 🚀 部署和运行

### 环境要求
- Python 3.8+
- Node.js 16+
- 8GB+ RAM (推荐)

### 快速启动

1. **后端启动**
```bash
cd backend
pip install -r requirements.txt
python main.py
```

2. **前端启动**
```bash
cd frontend
npm install
npm run dev
```

3. **环境配置**
```bash
# 设置API密钥
export API_KEY="your-deepseek-api-key"
export BASE_URL="https://api.deepseek.com/v1"

# 可选：LLM增强功能
export QWEN_API_KEY="your-qwen-api-key"
export OPENAI_API_KEY="your-openai-api-key"
```

## 📊 性能特性

- **文档处理速度**: 1-5秒/页（取决于复杂度）
- **并发支持**: 支持多用户同时使用
- **内存优化**: 智能缓存减少重复计算
- **响应时间**: 流式响应，首字符<1秒

## 🔮 未来规划

- [ ] 支持更多文档格式（Markdown、TXT等）
- [ ] 增加文档摘要和关键词提取
- [ ] 实现文档版本对比功能
- [ ] 添加用户认证和权限管理
- [ ] 支持文档批量处理
- [ ] 集成更多LLM服务商

---

**项目特色**: 将先进的多智能体技术与高质量文档处理相结合，为用户提供专业、智能的文档分析和对话服务。
