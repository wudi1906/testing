# PDFå›¾ç‰‡æè¿°åŠŸèƒ½å®æ–½æŒ‡å—

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

åŸºäºå¯¹markeræºç çš„æ·±å…¥åˆ†æï¼Œ**markerå®Œå…¨æ”¯æŒæ‚¨çš„éœ€æ±‚**ï¼š
- âœ… PDFä¸­çš„å›¾ç‰‡ä¼šè¢«å¤šæ¨¡æ€LLMè½¬æ¢ä¸ºè¯¦ç»†çš„æ–‡å­—æè¿°
- âœ… å›¾ç‰‡æè¿°ä¿æŒåœ¨åŸå›¾ç‰‡ä½ç½®ï¼Œç»´æŠ¤æ–‡æ¡£ç»“æ„
- âœ… æ”¯æŒå›¾è¡¨ã€æµç¨‹å›¾ã€ç…§ç‰‡ç­‰å„ç§å›¾ç‰‡ç±»å‹
- âœ… ç°æœ‰ç»„ä»¶å¯ç›´æ¥é›†æˆæ­¤åŠŸèƒ½

## ğŸ”§ æ ¸å¿ƒé…ç½®

### å…³é”®å‚æ•°ç»„åˆ

```python
config = {
    "use_llm": True,                    # å¯ç”¨LLMåŠŸèƒ½
    "disable_image_extraction": True,   # ç¦ç”¨å›¾ç‰‡æå–ï¼Œå¯ç”¨æè¿°ç”Ÿæˆ
    "openai_model": "gpt-4o",          # ä½¿ç”¨æ”¯æŒè§†è§‰çš„æ¨¡å‹
}
```

**é‡è¦è¯´æ˜**ï¼š
- `use_llm=True` + `disable_image_extraction=True` æ˜¯å¯ç”¨å›¾ç‰‡æè¿°çš„å…³é”®ç»„åˆ
- å½“è¿™ä¸¤ä¸ªå‚æ•°åŒæ—¶ä¸ºTrueæ—¶ï¼Œmarkerä¼šè‡ªåŠ¨å°†å›¾ç‰‡æ›¿æ¢ä¸ºAIç”Ÿæˆçš„æè¿°

## ğŸš€ å¿«é€Ÿå®æ–½

### 1. æ›´æ–°ç°æœ‰é…ç½®

å·²ç»ä¸ºæ‚¨æ›´æ–°äº† `components/config.py`ï¼š

```python
@dataclass
class MarkerConfig:
    # å›¾ç‰‡æè¿°é…ç½®
    use_llm: bool = True
    disable_image_extraction: bool = True  # å¯ç”¨å›¾ç‰‡æè¿°
    enable_image_description: bool = True
    
    # ä½¿ç”¨æ”¯æŒè§†è§‰çš„æ¨¡å‹
    openai_model: str = "gpt-4o"
    qwen_model: str = "qwen-vl-max-latest"
```

### 2. æ›´æ–°DocumentService

å·²ç»æ›´æ–°äº† `backend/document_service.py`ï¼š

```python
self.config = MarkerConfig(
    use_llm=self._should_use_llm(),
    enable_image_description=True,
    disable_image_extraction=self._should_use_llm(),
    openai_model="gpt-4o",  # æ”¯æŒè§†è§‰çš„æ¨¡å‹
    qwen_model="qwen-vl-max-latest"
)
```

### 3. è®¾ç½®APIå¯†é’¥

```bash
# ä½¿ç”¨OpenAI GPT-4 Vision (æ¨è)
export OPENAI_API_KEY="your-openai-api-key"

# æˆ–ä½¿ç”¨é˜¿é‡Œäº‘é€šä¹‰åƒé—®
export QWEN_API_KEY="your-qwen-api-key"

# æˆ–ä½¿ç”¨Google Gemini
export GOOGLE_API_KEY="your-google-api-key"
```

## ğŸ“Š æ”¯æŒçš„å¤šæ¨¡æ€æ¨¡å‹

### 1. OpenAI GPT-4 Vision (æ¨è)

```python
config = MarkerConfig(
    use_llm=True,
    disable_image_extraction=True,
    openai_model="gpt-4o",  # æˆ– "gpt-4-vision-preview"
    openai_api_key="your-openai-key"
)
```

**ä¼˜åŠ¿**ï¼š
- å›¾ç‰‡ç†è§£èƒ½åŠ›å¼º
- æè¿°è¯¦ç»†å‡†ç¡®
- æ”¯æŒå¤æ‚å›¾è¡¨åˆ†æ

### 2. é˜¿é‡Œäº‘é€šä¹‰åƒé—®

```python
config = MarkerConfig(
    use_llm=True,
    disable_image_extraction=True,
    qwen_model="qwen-vl-max-latest",
    qwen_api_key="your-qwen-key"
)
```

**ä¼˜åŠ¿**ï¼š
- ä¸­æ–‡æè¿°æ›´è‡ªç„¶
- æˆæœ¬ç›¸å¯¹è¾ƒä½
- å›½å†…è®¿é—®ç¨³å®š

### 3. Google Gemini

```python
config = MarkerConfig(
    use_llm=True,
    disable_image_extraction=True,
    llm_service="marker.services.google.GoogleService",
    google_api_key="your-google-key"
)
```

## ğŸ¨ è¾“å‡ºæ•ˆæœç¤ºä¾‹

### è¾“å…¥PDFåŒ…å«ï¼š
- é”€å”®æ•°æ®å›¾è¡¨
- ç»„ç»‡æ¶æ„å›¾
- äº§å“ç…§ç‰‡

### è¾“å‡ºMarkdownï¼š

```markdown
# å¹´åº¦æŠ¥å‘Š

## é”€å”®ä¸šç»©

2023å¹´å…¬å¸é”€å”®è¡¨ç°ä¼˜å¼‚...

[å›¾ç‰‡æè¿°: è¿™æ˜¯ä¸€ä¸ªå±•ç¤º2023å¹´å­£åº¦é”€å”®æ•°æ®çš„æŸ±çŠ¶å›¾ã€‚æ¨ªè½´æ˜¾ç¤ºQ1-Q4å››ä¸ªå­£åº¦ï¼Œçºµè½´æ˜¾ç¤ºé”€å”®é¢ï¼ˆä¸‡å…ƒï¼‰ã€‚Q1ä¸º150ä¸‡ï¼ŒQ2ä¸º200ä¸‡ï¼ŒQ3ä¸º280ä¸‡ï¼ŒQ4ä¸º320ä¸‡ï¼Œå‘ˆç°ç¨³å®šå¢é•¿è¶‹åŠ¿ã€‚å›¾è¡¨ä½¿ç”¨è“è‰²æŸ±çŠ¶ï¼ŒèƒŒæ™¯ä¸ºç™½è‰²ï¼Œæ ‡é¢˜ä¸º"2023å¹´å­£åº¦é”€å”®ä¸šç»©"ã€‚]

ä»å›¾è¡¨å¯ä»¥çœ‹å‡ºï¼Œé”€å”®å‘ˆç°ç¨³å®šå¢é•¿...

## ç»„ç»‡æ¶æ„

[å›¾ç‰‡æè¿°: è¿™æ˜¯ä¸€ä¸ªå…¬å¸ç»„ç»‡æ¶æ„å›¾ï¼Œé‡‡ç”¨æ ‘çŠ¶ç»“æ„ã€‚æœ€ä¸Šå±‚æ˜¯CEOï¼Œä¸‹é¢åˆ†ä¸ºä¸‰ä¸ªéƒ¨é—¨ï¼šæŠ€æœ¯éƒ¨ï¼ˆåŒ…å«å¼€å‘ç»„ã€æµ‹è¯•ç»„ï¼‰ã€é”€å”®éƒ¨ï¼ˆåŒ…å«å¸‚åœºç»„ã€å®¢æœç»„ï¼‰ã€è¿è¥éƒ¨ï¼ˆåŒ…å«äººäº‹ç»„ã€è´¢åŠ¡ç»„ï¼‰ã€‚æ¯ä¸ªèŒä½ç”¨è“è‰²çŸ©å½¢æ¡†è¡¨ç¤ºï¼Œç”¨é»‘è‰²çº¿æ¡è¿æ¥ä¸Šä¸‹çº§å…³ç³»ã€‚]

å…¬å¸é‡‡ç”¨æ‰å¹³åŒ–ç®¡ç†...

## äº§å“å±•ç¤º

[å›¾ç‰‡æè¿°: è¿™æ˜¯ä¸€å¼ äº§å“å±•ç¤ºç…§ç‰‡ï¼Œæ˜¾ç¤ºäº†ä¸€æ¬¾ç™½è‰²çš„æ™ºèƒ½æ‰‹æœºã€‚æ‰‹æœºå±å¹•æ˜¾ç¤ºç€åº”ç”¨ç•Œé¢ï¼ŒèƒŒæ™¯æ˜¯ç®€æ´çš„ç°è‰²ã€‚æ‰‹æœºæ”¾ç½®åœ¨æœ¨è´¨æ¡Œé¢ä¸Šï¼Œæ—è¾¹æœ‰ä¸€ä¸ªé»‘è‰²çš„å……ç”µå™¨ã€‚æ•´ä½“æ‹æ‘„è§’åº¦ä¸º45åº¦ä¿¯è§†ï¼Œå…‰çº¿æŸ”å’Œï¼Œçªå‡ºäº§å“çš„è®¾è®¡æ„Ÿã€‚]
```

## ğŸ” æŠ€æœ¯åŸç†

### å¤„ç†æµç¨‹

```
PDFè¾“å…¥ â†’ é¡µé¢è§£æ â†’ å›¾ç‰‡æ£€æµ‹ â†’ ä½ç½®æ ‡è®° â†’ LLMåˆ†æ â†’ ç”Ÿæˆæè¿° â†’ æ’å…¥markdown â†’ è¾“å‡º
```

### å…³é”®æ­¥éª¤

1. **å›¾ç‰‡æ£€æµ‹**ï¼šmarkerè‡ªåŠ¨è¯†åˆ«PDFä¸­çš„å›¾ç‰‡åŒºåŸŸ
2. **ä½ç½®ä¿æŒ**ï¼šè®°å½•å›¾ç‰‡åœ¨æ–‡æ¡£ä¸­çš„ç²¾ç¡®ä½ç½®
3. **å›¾ç‰‡æå–**ï¼šå°†å›¾ç‰‡æ•°æ®ä¼ é€’ç»™å¤šæ¨¡æ€LLM
4. **æè¿°ç”Ÿæˆ**ï¼šLLMåˆ†æå›¾ç‰‡å†…å®¹ï¼Œç”Ÿæˆè¯¦ç»†æè¿°
5. **å†…å®¹æ›¿æ¢**ï¼šå°†å›¾ç‰‡æ›¿æ¢ä¸º `[å›¾ç‰‡æè¿°: ...]` æ ¼å¼çš„æ–‡æœ¬
6. **ç»“æ„ä¿æŒ**ï¼šç¡®ä¿æè¿°æ’å…¥åˆ°åŸå›¾ç‰‡ä½ç½®

## ğŸ“ˆ æ€§èƒ½å’Œæˆæœ¬

### å¤„ç†é€Ÿåº¦
- çº¯æ–‡æœ¬é¡µé¢ï¼š1-2ç§’/é¡µ
- åŒ…å«å›¾ç‰‡é¡µé¢ï¼š5-15ç§’/é¡µï¼ˆå–å†³äºå›¾ç‰‡æ•°é‡å’Œå¤æ‚åº¦ï¼‰

### APIæˆæœ¬ä¼°ç®—ï¼ˆä»¥GPT-4Vä¸ºä¾‹ï¼‰
- æ–‡æœ¬å¤„ç†ï¼š~$0.01/é¡µ
- ç®€å•å›¾ç‰‡ï¼š~$0.05/å›¾
- å¤æ‚å›¾è¡¨ï¼š~$0.10-0.20/å›¾

### å‡†ç¡®æ€§
- æ–‡æœ¬æå–ï¼š95%+
- å›¾ç‰‡æè¿°ï¼š90%+ï¼ˆå–å†³äºå›¾ç‰‡æ¸…æ™°åº¦å’Œå¤æ‚åº¦ï¼‰

## ğŸ› ï¸ å®é™…éƒ¨ç½²

### 1. å®‰è£…ä¾èµ–

```bash
pip install marker-pdf>=1.7.0
```

### 2. éªŒè¯åŠŸèƒ½

```python
# æµ‹è¯•é…ç½®
python test_image_description.py

# å®é™…å¤„ç†
from backend.document_service import DocumentService

doc_service = DocumentService()
result = await doc_service.save_and_extract_file(pdf_file, session_id)
```

### 3. å‘½ä»¤è¡Œä½¿ç”¨

```bash
# åŸºç¡€å›¾ç‰‡æè¿°
marker_single document.pdf --output_dir output --use_llm --disable_image_extraction

# é«˜è´¨é‡å¤„ç†ï¼ˆåŒ…å«æ•°å­¦å…¬å¼ï¼‰
marker_single document.pdf --output_dir output --use_llm --disable_image_extraction --redo_inline_math
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æ¨¡å‹é€‰æ‹©
- **å¤æ‚å›¾è¡¨**ï¼šä½¿ç”¨GPT-4Væˆ–Gemini Pro Vision
- **ä¸­æ–‡å†…å®¹**ï¼šä¼˜å…ˆä½¿ç”¨é€šä¹‰åƒé—®
- **æˆæœ¬æ•æ„Ÿ**ï¼šä½¿ç”¨GPT-4o-mini

### 2. é…ç½®ä¼˜åŒ–
```python
# é«˜è´¨é‡é…ç½®
config = MarkerConfig(
    use_llm=True,
    disable_image_extraction=True,
    format_lines=True,
    redo_inline_math=True,  # æå‡æ•°å­¦å…¬å¼è´¨é‡
    openai_model="gpt-4o"
)
```

### 3. é”™è¯¯å¤„ç†
```python
try:
    result = await processor.process_file(pdf_path)
    # æ£€æŸ¥æ˜¯å¦åŒ…å«å›¾ç‰‡æè¿°
    if "[å›¾ç‰‡æè¿°:" in result.content:
        print("âœ… å›¾ç‰‡æè¿°åŠŸèƒ½æ­£å¸¸å·¥ä½œ")
except Exception as e:
    print(f"å¤„ç†å¤±è´¥: {e}")
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å›¾ç‰‡æ²¡æœ‰è¢«æè¿°**
   - æ£€æŸ¥ï¼š`use_llm=True` ä¸” `disable_image_extraction=True`
   - æ£€æŸ¥ï¼šAPIå¯†é’¥æ˜¯å¦æ­£ç¡®è®¾ç½®
   - æ£€æŸ¥ï¼šä½¿ç”¨çš„æ˜¯æ”¯æŒè§†è§‰çš„æ¨¡å‹

2. **æè¿°è´¨é‡ä¸ä½³**
   - å°è¯•æ›´æ¢æ¨¡å‹ï¼ˆGPT-4V â†’ Gemini â†’ é€šä¹‰åƒé—®ï¼‰
   - æ£€æŸ¥å›¾ç‰‡æ¸…æ™°åº¦
   - è€ƒè™‘ä½¿ç”¨æ›´é«˜çº§çš„æ¨¡å‹

3. **å¤„ç†é€Ÿåº¦æ…¢**
   - æ­£å¸¸ç°è±¡ï¼Œå›¾ç‰‡åˆ†æéœ€è¦æ—¶é—´
   - è€ƒè™‘æ‰¹é‡å¤„ç†ä»¥æé«˜æ•ˆç‡
   - ä½¿ç”¨æ›´å¿«çš„æ¨¡å‹ï¼ˆå¦‚GPT-4o-miniï¼‰

## ğŸ‰ æ€»ç»“

**Markerå®Œå…¨èƒ½å¤Ÿå®ç°æ‚¨çš„éœ€æ±‚ï¼**

âœ… **åŸç”Ÿæ”¯æŒ**ï¼šmarkerå†…ç½®å›¾ç‰‡æè¿°åŠŸèƒ½
âœ… **é…ç½®ç®€å•**ï¼šåªéœ€ä¸¤ä¸ªå…³é”®å‚æ•°
âœ… **æ•ˆæœä¼˜ç§€**ï¼šä¿æŒä½ç½®ï¼Œæè¿°è¯¦ç»†
âœ… **å¤šæ¨¡å‹æ”¯æŒ**ï¼šOpenAIã€Googleã€é˜¿é‡Œäº‘
âœ… **å³æ’å³ç”¨**ï¼šç°æœ‰ç»„ä»¶ç›´æ¥é›†æˆ

è¿™æ˜¯ä¸€ä¸ªæˆç†Ÿã€å¯é çš„è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿé«˜è´¨é‡åœ°å°†PDFä¸­çš„å›¾ç‰‡è½¬æ¢ä¸ºè¯¦ç»†çš„æ–‡å­—æè¿°ï¼Œå®Œç¾æ»¡è¶³æ‚¨çš„éœ€æ±‚ï¼
